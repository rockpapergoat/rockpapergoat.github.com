
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>a rock, a paper, and a goat</title>
  <meta name="author" content="nate st.germain">

  
  <meta name="description" content="the other night, gary tweeted about a puppet/os x 10.7 password bug i started looking at awhile back. it&#8217;s good practice. i&#8217;ve been less &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rockpapergoat.github.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="a rock, a paper, and a goat" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">a rock, a paper, and a goat</a></h1>
  
    <h2>a love story</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rockpapergoat.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/09/some-tinkering-with-hashed-passwords/">Some Tinkering With Hashed Passwords</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-09T13:06:00-05:00" pubdate data-updated="true">Dec 9<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>the other night, <a href="http://twitter.com/#!/glarizza">gary</a> tweeted about a puppet/os x 10.7 password <a href="http://projects.puppetlabs.com/issues/11293">bug</a> i started looking at awhile back.</p>

<p>it&#8217;s good practice. i&#8217;ve been less focused on ruby lately than i&#8217;d like, and as <a href="http://sysadvent.blogspot.com/2011/12/day-6-always-be-hacking.html">@lusis</a> says: &#8220;always be hacking.&#8221;</p>

<p>here&#8217;s some notes from gary on the problem:</p>

<div><script src='https://gist.github.com/1445481.js?file='></script>
<noscript><pre><code>Password Hash Accessing:

* Grab plist file from /var/db/dslocal/nodes/Default/users/username.plist
* Convert to xml 

        plutil -convert xml1 username.plist
* Grab the ShadowHashData key and base64 decode it (install base64 with port install base64)

        echo &quot;Data from ShadowHashData Key&quot; | base64 -d &gt; ShadowHashData
* Convert the resultant binary plist file into xml

        plutil -convert xml1 ShadowHashData
* Grab the SALTED-SHA512 Key and base64 decode it

        echo &quot;Data from SALTED-SHA512 Key&quot; | base64 -d &gt; hashfile
*Reveal hash:

        xxd -p -c 256 hashfile | cut -c 9-


## Opening a user plist from 10.7 and getting the binary-encoded bit
        require 'rexml/document'
        xml = File.read('file.plist')
        doc = REXML::Document.new(xml)
        puts String(doc.root.elements[1][7][1][0]).gsub(&quot;\n&quot;,&quot;&quot;).gsub(&quot;\t&quot;,&quot;&quot;)

## Using CFPropertyList
        require 'cfpropertylist'
        require 'base64'
        newplist = CFPropertyList::List.new(:file =&gt; 'demouser_edit.plist')
        newdata = CFPropertyList.native_types(newplist.value)
        bplist = CFPropertyList::List.new
        bplist.load_binary_str(newdata['ShadowHashData'][0])
        bplistdata = CFPropertyList.native_types(bplist.value)
        password_hash = bplistdata['SALTED-SHA512'].unpack(&quot;H*&quot;)[0][8..-1]


Nate's Gist --&gt; https://gist.github.com/1445697</code></pre></noscript></div>


<p>and here&#8217;s a bit of what i worked out so far:</p>

<div><script src='https://gist.github.com/1445697.js?file='></script>
<noscript><pre><code>#!/usr/bin/env ruby
## parse os x 10.7 shado hash data
#
require &quot;rexml/document&quot;
include REXML
require &quot;base64&quot;

def parse_plist(plist)
    parsed = []
    doc = Document.new File.new(plist)
    doc.elements.each(&quot;plist/data&quot;) {|e| parsed &lt;&lt; e}
end

def base64_shadow(hash)
   encoded = Base64.encode64(hash) 
   decoded = Base64.decode64(Base64.encode64(hash))
   #puts &quot;encoded: #{encoded}&quot;
   #puts &quot;decoded: #{decoded}&quot;
end




puts parse_plist(&quot;/tmp/password.plist&quot;)
base64_shadow(&quot;password&quot;)
</code></pre></noscript></div>


<p>i always enjoy collaborating with people across the &#8216;tubes. there&#8217;s no real point to this post; just jotting down some thoughts while waiting for some processes to finish.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/23/mcollective-tinkering/">Mcollective Tinkering, Part 2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-23T18:53:00-05:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>following up the previous post, i have a working <a href="https://github.com/rockpapergoat/mcollective-plugins/tree/macutil/agent/macutil">agent</a> uploaded. so far, it doesn&#8217;t do too much.</p>

<p>i also sort of take back the gripe about agent documentation. i see now there&#8217;s some facility for including usage statements, though i&#8217;ve only seen them in application files, not agents. need to check the docs again&#8230;</p>

<p>next up is getting a handle on input and output syntax and doing more interesting things. i intend to gear the macutil agent toward common os x specific tasks one might want to perform, but as i&#8217;m running through a pile of utility scripts, it&#8217;s pretty obvious that so much of these one-off shell/ruby/python/whatever scripts are reactionary. there are many places where proper configuration management tools and processes are a more appropriate fit.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/21/mcollective-tinkering/">Mcollective Tinkering</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-21T16:54:00-05:00" pubdate data-updated="true">Nov 21<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>yesterday&#8217;s afternoon activities included messing with <a href="http://puppetlabs.com/mcollective/introduction">mcollective</a> agents. i&#8217;m working on an agent that provides a lot of the same one-off, scripted checks that i&#8217;ve written in the past for os x clients. it should be somewhat useful, i hope.</p>

<p>i&#8217;ll be sure to commit whatever working pieces soon.</p>

<p>one of my minor annoyances with the mcollective documentation (which is generally good) is that it skips some of the really basic things, like how to invoke an agent from the command line. for instance, it&#8217;s helpful to provide examples of how to pass arguments, like so:</p>

<div><script src='https://gist.github.com/1384106.js?file='></script>
<noscript><pre><code> mco rpc etc_facts search -F &quot;operatingsystem=~/[dD]arwin/&quot; --arg=&quot;fact=form&quot;
</code></pre></noscript></div>


<p>i&#8217;ll add examples for how to call agents either in the ddl or agent code itself. seeing examples in the ddl via the built in help would be nice, though.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/10/a-new-blog/">A New Blog</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-10T20:36:00-05:00" pubdate data-updated="true">Nov 10<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>after a long hiatus, i&#8217;m starting a new blog using <a href="http://octopress.org">octopress</a>. my <a href="http://nate.adullmoment.com">old blog</a> was built using <a href="http://hobix.github.com/hobix/">hobix</a>, which has been abandoned for a few years now. after <a href="http://en.wikipedia.org/wiki/Why_the_lucky_stiff">why</a> disappeared, there hasn&#8217;t been much development with hobix. i also haven&#8217;t had the time or inclination to fix the things that are broken with my install.</p>

<p>so we&#8217;ll see how this goes. twitter has replaced regular blogging for most people i know.</p>

<p>i have a couple of other blogs out there that get sporadic updates. i&#8217;ll link to those, as well.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/12/09/some-tinkering-with-hashed-passwords/">some tinkering with hashed passwords</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/23/mcollective-tinkering/">mcollective tinkering, part 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/21/mcollective-tinkering/">mcollective tinkering</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/10/a-new-blog/">a new blog</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/rockpapergoat">@rockpapergoat</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rockpapergoat',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("rockpapergoat", 4, true);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/rockpapergoat" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @rockpapergoat</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - nate st.germain -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
